---
title: "jsipfs - ipfs-http-response - HTML Injection in Dirlisting"
date: 2021-07-28T16:54:44+02:00

cve: 
vendor: Protocol Labs
vendorUrl: https://js.ipfs.io/
authors: tintinweb
affectedVersions: ["<= ipfs@0.56.0", "<= js-ipfs-http-response@0.7.0"]
vulnClass: CWE-80


---


<font size="8">**Vulnerability Note**</font>

## Summary

The gateway mode in `js-ipfs` provides an autogenerated directory listing for ipfs CID's that resolve to a folder. This directory listing is generated by [ipfs-http-response](https://github.com/ipfs/js-ipfs-http-response). The problem is that the `dir-view` component in `ipfs-http-response` does not encode CID metadata for use in HTML before string-concatenating it into a static HTML dir-viewer page that is later served via the `js-ipfs` HTTP gateway.

The severity is rather **low**, though, due to the nature of this injection one could easily deploy a HTML CID instead to achieve a similar result. However, things might get more interesting if this package is being used in a more privileged context.

## Details

### Description

The [dir-view/index.js](https://github.com/ipfs/js-ipfs-http-response/blob/68f12049318a44f21f5e81a6af818272ebf4d16f/src/dir-view/index.js#L21) component returns a HTML rendered directory listing. `Link.name` (any any other untrusted inputs) are not encoded before being inserted in the HTML template. This allows for HTML/Script injection on the dir-view page.


### Proof of Concept

* let's create a new folder with files containing HTML chars (note that we can directly manipulate ipfs CID links by creating CIDs manually)

```
⇒  IPFS_PATH=./ipfs3 IPFS_LOGGING=debug  node ../../../js/js-ipfs/packages/ipfs/src/cli.js add -r -w "testi"
added QmWsCoFw8wtya9U9QQRfso93puB7HuhPdeQ8smMJudb4ja testi/<hr><hr>oo
added QmVhSdefteV6RbzhEywrPmt1qsa3LdNudgBxANgo4s4PDJ testi/<marquee>yolohi
added QmWR8w4Q7CVJ4zDmYX7zWkcrPdy7GCVv8XYZhoc1PJswhg testi/yay
added QmagxXdk5L29XMc1ZbWaoewQqJLzK9qrUaHLkR5RA3EmJQ testi
added Qmbw1zpg677H9P74vt1vTM1zQtUabvd2Fi6HaKDn6krJtR
```

* run ipfs in daemon mode: `⇒  IPFS_PATH=./ipfs3 IPFS_LOGGING=debug  node ../../../js/js-ipfs/packages/ipfs/src/cli.js daemon`

* navigate to CID `Qmbw1zpg677H9P74vt1vTM1zQtUabvd2Fi6HaKDn6krJtR`

![ipfs-marquee](https://user-images.githubusercontent.com/2865694/127372211-df569f74-8168-4475-9476-bd7c12291b5f.gif)


### Proposed Fix

Properly encode link attributes before using them in the context of an HTML webpage. Use a template enginge that automatically encodes inputs for use within HTML.

## Vendor Response


Vendor response: fixes [ipfs@0.58.4](https://github.com/ipfs/js-ipfs/releases/tag/ipfs%400.58.4) and [js-ipfs-http-response@v1.0.1](https://github.com/ipfs/js-ipfs-http-response/releases/tag/v1.0.1).

### Timeline

```
JUL/28/2021 - shared with security[at]ipfs
SEP/08/2021 - fixed with ipfs@0.58.4 (js-ipfs-http-response@v1.0.1)
```


